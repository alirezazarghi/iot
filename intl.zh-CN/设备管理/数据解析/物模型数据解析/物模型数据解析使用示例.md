---
keyword: [物联网, IoT, 物联网平台, 编写, 解析, 转换, 脚本, 示例代码, 透传数据, 自定义格式, Alink, rawdatatoprotocol, protocolToRawData]
---

# 物模型数据解析使用示例

本文以解析上、下行属性数据的脚本为例，介绍在**数据格式**为**透传/自定义**的产品下，物模型数据解析脚本的编写方法。

## 步骤一：编辑脚本

1.  在[物联网平台控制台](http://iot.console.aliyun.com/)，创建产品。

    具体操作，请参见[创建产品](/intl.zh-CN/设备接入/创建产品.md)。

    **说明：** **数据格式**选择为**透传/自定义**。

2.  为该产品定义物模型。自定义属性的操作说明，请参见[单个添加物模型](/intl.zh-CN/设备管理/物模型/单个添加物模型.md)。

    本示例中定义了以下三个属性：

    |标识符（identifier）|数据类型|取值范围|读写类型|
    |:--------------|:---|:---|:---|
    |prop\_float|浮点单精度 float|-100~100|读写|
    |prop\_int16|整数型 int32|-100~100|读写|
    |prop\_bool|布尔型 bool|0：开；1：关|读写|

    数据解析脚本将根据这里定义的物模型来编写，用于解析上下行物模型数据。

3.  在设备通信协议中做如下定义：

    |字段|字节数|
    |:-|:--|
    |帧类型|1字节|
    |请求ID|4字节|
    |属性prop\_int16|2字节|
    |属性prop\_bool|1字节|
    |属性prop\_float|4字节|

    |字段|字节数|
    |:-|:--|
    |帧类型|1字节|
    |请求ID|4字节|
    |结果code|1字节|

    |字段|字节数|
    |:-|:--|
    |帧类型|1字节|
    |请求ID|4字节|
    |属性prop\_int16|2字节|
    |属性prop\_bool|1字节|
    |属性prop\_float|4字节|

    |字段|字节数|
    |:-|:--|
    |帧类型|1字节|
    |请求ID|4字节|
    |结果code|1字节|

4.  编写脚本。

    1.  在产品页，单击产品对应的**查看**。

    2.  在产品详情页，选择**数据解析**页签。

    3.  选择脚本语言，然后在**编辑脚本**下的输入框中输入脚本。

        目前支持三种脚本语言：JavaScript（ECMAScript 5）、Python 2.7和PHP 7.2。

        脚本中需定义调用以下两个函数，分别用于解析上、下行物模型数据。

        -   将Alink JSON格式数据转为设备自定义数据格式的函数：
            -   JavaScript（ECMAScript 5）：protocolToRawData
            -   Python 2.7：protocol\_to\_raw\_data
            -   PHP 7.2：protocolToRawData
        -   将设备自定义数据格式转Alink JSON格式数据的函数：
            -   JavaScript（ECMAScript 5）：rawDataToProtocol
            -   Python 2.7：raw\_data\_to\_protocol
            -   PHP 7.2：rawDataToProtocol
        完整的示例脚本Demo，请参见[JavaScript脚本示例](/intl.zh-CN/设备管理/数据解析/物模型数据解析/JavaScript脚本示例.md)、[Python脚本示例](/intl.zh-CN/设备管理/数据解析/物模型数据解析/Python脚本示例.md)和[PHP脚本示例](/intl.zh-CN/设备管理/数据解析/物模型数据解析/PHP脚本示例.md)。

        **说明：** 您还需编写自定义Topic的上行数据解析脚本，相关脚本编写说明，请参见[提交数据解析脚本](/intl.zh-CN/设备管理/数据解析/自定义Topic数据解析/提交数据解析脚本.md)。

        包含自定义Topic数据解析和物模型数据解析的完整示例脚本，请参见[透传/自定义产品完整示例脚本（JavaScript）]()、[透传/自定义产品完整示例脚本（Python）]()和[透传/自定义产品完整示例脚本（PHP）]()。


## 步骤二：在线测试脚本

脚本编辑完成后，在**模拟输入**下，选择**模拟类型**，输入模拟数据在线测试脚本。

**说明：** 下文中传入和返回的十六进制字符串和JSON格式数据仅为示例，实际场景中，不可直接用于调试。

-   模拟解析设备上报的属性数据。

    选择模拟类型为设备上报数据，输入以下模拟的设备上报数据，然后单击**执行**。

    **说明：** 以下传入参数模拟数据仅适用于JavaScript脚本，更多示例内容，请参见[JavaScript脚本示例](/intl.zh-CN/设备管理/数据解析/物模型数据解析/JavaScript脚本示例.md)。

    Python、PHP脚本的传入参数模拟数据，请参见[Python脚本示例](/intl.zh-CN/设备管理/数据解析/物模型数据解析/Python脚本示例.md)、[PHP脚本示例](/intl.zh-CN/设备管理/数据解析/物模型数据解析/PHP脚本示例.md)。

    您可使用字符串转十六进制工具，将待传入参数JSON格式数据转为十六进制格式数据。例如转化后为`00002233441232013fa00000`，则输入如下数据。

    ```
    0x00002233441232013fa00000
    ```

    数据解析引擎会按照脚本规则，将透传数据转换为JSON格式数据。

    单击**运行结果**，查看解析结果。

    ```
    {
        "method": "thing.event.property.post", 
        "id": "2241348", 
        "params": {
            "prop_float": 1.25, 
            "prop_int16": 4658, 
            "prop_bool": 1
        }, 
        "version": "1.0"
    }
    ```

-   模拟解析物联网平台下发的返回结果数据。

    选择模拟类型为**设备接收数据**，输入以下JSON格式数据，然后单击**执行**。

    ```
    {
      "id": "12345",
      "version": "1.0",
      "code": 200,
      "method": "thing.event.property.post",
      "data": {}
    }
    ```

    数据解析引擎会将JSON格式数据转换为以下数据：

    ```
    0x0200003039c8
    ```

-   模拟解析物联网平台下发的属性设置数据。

    选择模拟类型为设备接收数据，输入以下JSON格式数据，然后单击**执行**。

    ```
    {
        "method": "thing.service.property.set", 
        "id": "12345", 
        "version": "1.0", 
        "params": {
            "prop_float": 123.452, 
            "prop_int16": 333, 
            "prop_bool": 1
        }
    }
    ```

    数据解析引擎会将JSON格式数据转换为以下数据：

    ```
    0x0100003039014d0142f6e76d
    ```

-   模拟解析设备返回的属性设置结果数据。

    选择模拟类型为设备上报数据，输入以下数据，然后单击**执行**。

    ```
    0x0300223344c8
    ```

    数据解析引擎会将透传数据转换为以下JSON格式数据：

    ```
    {
      "code": "200",
      "data": {},
      "id": "2241348",
      "version": "1.0"
    }
    ```


## 步骤三：提交脚本

确认脚本可以正确解析数据后，单击**提交**，将该脚本提交到物联网平台系统，以供数据上下行时，物联网平台调用该脚本解析数据。

**说明：** 仅提交后的脚本才能被物联网平台调用；草稿状态的脚本不能被调用。

![提交脚本](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1286549951/p47128.png)

## 步骤四：使用真实设备调试

正式使用脚本之前，请使用真实设备与物联网平台进行上下行消息通信，以验证物联网平台能顺利调用脚本，解析上下行数据。

-   测试上报属性数据。
    1.  使用设备端上报设备属性数据，例如`0x00002233441232013fa00000`。
    2.  在物联网平台控制台，选择**设备管理** \> **设备**。
    3.  单击设备对应的**查看**，然后在设备详情页**物模型数据** \> **运行状态**页签下，查看是否有相应的属性数据。
-   测试下发属性数据。
    1.  在物联网平台控制台，选择**监控运维** \> **在线调试**。
    2.  选择要调试的产品和设备，并选择**调试真实设备**，功能选择为要调试的属性identifier，如属性（prop\_int16），方法选择为**设置**，输入以下数据，单击**发送指令**。

        ```
        {
            "method": "thing.service.property.set", 
            "id": "12345", 
            "version": "1.0", 
            "params": {
                "prop_float": 123.452, 
                "prop_int16": 333, 
                "prop_bool": 1
            }
        }
        ```

    3.  查看设备端是否收到该属性设置指令。
    4.  在该设备的设备详情页**物模型数据** \> **运行状态**页签下，查看设备是否上报当前属性数据。

## 相关文档

-   查看JavaScript（ECMAScript 5）脚本模板和示例，请参见[JavaScript脚本示例](/intl.zh-CN/设备管理/数据解析/物模型数据解析/JavaScript脚本示例.md)。
-   查看Python 2.7脚本模板和示例，请参见[Python脚本示例](/intl.zh-CN/设备管理/数据解析/物模型数据解析/Python脚本示例.md)
-   查看PHP 7.2脚本模板和示例，请参见[PHP脚本示例](/intl.zh-CN/设备管理/数据解析/物模型数据解析/PHP脚本示例.md)
-   了解数据解析流程等基本信息，请参见[什么是数据解析](/intl.zh-CN/设备管理/数据解析/什么是数据解析.md)。
-   有关自定义Topic数据解析说明，请参见[提交数据解析脚本](/intl.zh-CN/设备管理/数据解析/自定义Topic数据解析/提交数据解析脚本.md)。

