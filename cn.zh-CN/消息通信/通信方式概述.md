---
keyword: [IoT, 物联网, 通信]
---

# 通信方式概述

您的设备和服务器接入阿里云物联网平台，通过物联网平台进行通信。

## 设备发送数据到物联网平台

设备接入物联网平台后，便可与物联网平台进行通信。设备可通过以下方式发送数据到物联网平台：

-   使用自定义Topic发送自定义格式的数据。
    1.  在物联网平台上，为产品自定义**操作权限**为**发布**的Topic类。产品的Topic类会自动映射到产品下的设备中。

        自定义Topic类的两种方式：

        -   参见[自定义Topic](/cn.zh-CN/设备接入/消息通信Topic/自定义Topic.md)，在物联网平台控制台上自定义Topic类。
        -   使用[云端SDK](/cn.zh-CN/云端开发指南/云端SDK参考/下载云端SDK.md)，调用云端API [CreateProductTopic](/cn.zh-CN/云端开发指南/云端API参考/Topic管理/CreateProductTopic.md)自定义Topic类。
    2.  开发设备端时，配置设备将消息发送到自定义Topic中。

        需在设备端上，配置发送消息的自定义Topic和消息格式。使用阿里云提供的Link SDK配置示例，请参见[设备发送消息给服务器](/cn.zh-CN/最佳实践/消息通信/使用自定义Topic进行通信.md)。

-   使用物模型功能相关Topic，发送标准化的物模型数据。

    物模型功能说明，请参见[什么是物模型](/cn.zh-CN/设备管理/物模型/什么是物模型.md)。

    设备可主动上报属性和事件。

    实现过程：

    1.  参见[单个添加物模型](/cn.zh-CN/设备管理/物模型/单个添加物模型.md)，根据您的设备业务情况，在物联网平台控制台定义物模型。
    2.  开发设备端时，根据已定义的物模型，配置设备上报属性和事件数据。

        设备上报属性和事件的标准数据格式，请参见[设备上报属性](/cn.zh-CN/设备管理/Alink协议/设备属性、事件、服务.md)和[设备事件上报](/cn.zh-CN/设备管理/Alink协议/设备属性、事件、服务.md)。

        **说明：** 物联网平台已定义了物模型功能相关的Topic，直接使用即可。

        使用阿里云提供的Link SDK开发示例，请参见[设备端SDK上报属性和事件](/cn.zh-CN/最佳实践/消息通信/物模型通信.mdsection_l5d_7u3_9hp)。


## 物联网平台流转数据到服务器

可设置物联网平台，通过以下方式将设备上报消息、设备状态变化通知、设备生命周期变更、物模型历史数据上报、OTA升级状态通知、网关发现子设备上报、设备拓扑关系变更等消息流转到您的服务器。消息基于Topic传递数据，Topic中的数据格式请参见[数据格式](/cn.zh-CN/消息通信/数据格式.md)。

![Data to Server](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/8876549951/p87244.png)

-   服务端订阅：使用物联网平台的服务端订阅功能，订阅一个或多个消息类型。物联网平台根据您设置的订阅，将产品下所有设备的该类型消息流转至您的服务器。支持以下两种方式的服务端订阅：
    -   参见[AMQP服务端订阅](/cn.zh-CN/消息通信/服务端订阅/使用AMQP服务端订阅/配置AMQP服务端订阅.md)及相关文档，设置使用AMQP SDK接收物联网平台流转的设备消息。
    -   参见[MNS服务端订阅](/cn.zh-CN/消息通信/服务端订阅/使用MNS服务端订阅.md)，设置使用MNS SDK接收物联网平台流转到MNS队列的设备消息。
-   云产品流转：使用规则引擎的云产品流转功能，通过数据流转规则将指定设备数据流转到消息服务（MNS）的主题或消息队列（RocketMQ）的队列中。服务器通过MNS或RocketMQ SDK接收消息。

    1.  参见[设置数据流转规则](/cn.zh-CN/消息通信/云产品流转/设置数据流转规则.md)，创建规则，将指定设备的数据流转到MNS主题或RocketMQ队列中。
    2.  参见[MNS SDK主题使用手册]()或[RocketMQ使用手册]()中订阅消息部分，配置MNS SDK或RocketMQ SDK接收消息。
    使用规则引擎流转数据的示例，请参见[设备消息通过RocketMQ流转到服务器](/cn.zh-CN/最佳实践/消息通信/设备消息通过RocketMQ流转到服务器.md)。


云产品流转和服务端订阅的区别，请参见[数据流转方案对比](/cn.zh-CN/消息通信/云产品流转/数据流转方案对比.md)。

## 服务器远程控制设备

在服务器上，使用物联网平台提供的云端SDK，调用云端API发送指令到设备，实现远程控制设备。服务器可通过以下方式发送指令到设备。

![Control Devices](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/8876549951/p87249.png)

-   使用自定义Topic远程控制设备。
    -   异步控制：调用[Pub](/cn.zh-CN/云端开发指南/云端API参考/消息通信/Pub.md)接口向设备操作权限为**订阅**的自定义Topic发送自定义格式的消息。设备通过订阅该Topic获取消息。

        **说明：** 不可以使用Pub接口发送物模型相关指令。

        使用自定义Topic远程控制设备实践案例，请参见[服务器发送消息给设备](/cn.zh-CN/最佳实践/消息通信/使用自定义Topic进行通信.md)。

    -   同步控制：调用[RRpc](/cn.zh-CN/云端开发指南/云端API参考/消息通信/RRpc.md)接口向指定设备发送消息，并同步返回响应结果。

        MQTT同步通信相关说明，请参见[什么是RRPC](/cn.zh-CN/消息通信/MQTT同步通信（RRPC）/什么是RRPC.md)。

        调用RRpc接口同步控制设备实践案例，请参见[远程控制树莓派服务器](/cn.zh-CN/最佳实践/消息通信/远程控制树莓派服务器.md)。

    -   批量控制：调用[PubBroadcast](/cn.zh-CN/云端开发指南/云端API参考/消息通信/PubBroadcast.md)接口向产品下的全量在线设备发布广播消息，实现批量控制设备。

        批量控制设备的详细说明，请参见[广播通信](/cn.zh-CN/消息通信/广播通信.md)。

-   使用物模型远程控制设备。

    您可以在云端通过发送物模型数据的特有接口，发布设置属性值和调用服务指令。

    -   控制单个设备。
        -   调用[SetDeviceProperty](/cn.zh-CN/云端开发指南/云端API参考/物模型使用/SetDeviceProperty.md)向单个设备发送设置属性值的指令。

            云端下发属性设置命令和设备收到并执行该命令是异步的。设备是否成功设置属性值，以设备上报属性为准。

        -   调用[InvokeThingService](/cn.zh-CN/云端开发指南/云端API参考/物模型使用/InvokeThingService.md)向单个设备发送调用服务的指令。

            服务是同步调用还是异步调用，取决于您[自定义服务](/cn.zh-CN/设备管理/物模型/单个添加物模型.mdtable_lhs_fq3_y2b)时选择的调用方式。

            如果该服务的调用方式是**同步**，调用InvokeThingService后，会同步返回结果。

            如果是**异步**，则InvokeThingService不会同步返回结果。设备响应结果，可以通过规则引擎获取设备的响应消息。需设置规则SQL的数据来源Topic为**物模型数据上报**，具体Topic为`thing/downlink/reply/message`。数据流转规则设置详情，请参见[设置数据流转规则](/cn.zh-CN/消息通信/云产品流转/设置数据流转规则.md)。

    -   批量控制设备。
        -   调用[SetDevicesProperty](/cn.zh-CN/云端开发指南/云端API参考/物模型使用/SetDevicesProperty.md)向多个设备发送设置属性值的指令。
        -   调用[InvokeThingsService](/cn.zh-CN/云端开发指南/云端API参考/物模型使用/InvokeThingsService.md)向多个设备发送调用服务的指令。
    使用物模型远程控制设备的实践案例，请参见[物模型通信](/cn.zh-CN/最佳实践/消息通信/物模型通信.md)。


## 设备与设备之间通信

将两端设备接入物联网平台，设备间的连接和通信请求都由物联网平台承担。您可以通过以下两种方式实现设备与设备间通信：

-   [基于规则引擎的M2M设备间通信](/cn.zh-CN/最佳实践/消息通信/M2M设备间通信/基于规则引擎的M2M设备间通信.md)
-   [基于Topic消息路由的M2M设备间通信](/cn.zh-CN/最佳实践/消息通信/M2M设备间通信/基于Topic消息路由的M2M设备间通信.md)

## 设备数据使用场景示例

[通过大数据平台搭建设备监控大屏](/cn.zh-CN/最佳实践/场景应用/通过大数据平台搭建设备监控大屏.md)

[物联网平台对接第三方服务-天气查询](/cn.zh-CN/最佳实践/场景应用/物联网平台对接第三方服务-天气查询.md)

[温湿度计上报数据到钉钉群机器人](/cn.zh-CN/最佳实践/场景应用/温湿度计上报数据到钉钉群机器人.md)

[使用IoT Studio搭建监控大屏](/cn.zh-CN/最佳实践/场景应用/使用IoT Studio搭建气象监测屏/概述.md)

[设备消息通过RocketMQ流转到服务器](/cn.zh-CN/最佳实践/消息通信/设备消息通过RocketMQ流转到服务器.md)

[服务端订阅（MNS）](/cn.zh-CN/最佳实践/消息通信/服务端订阅（MNS）.md)

