# 公共实例存量设备迁移

本文介绍如何通过设备分发将公共实例中的存量设备迁移到您购买的实例。

相比于公共实例，您购买的实例支持更丰富的功能、更高的SLA保障、更灵活的规格配置、更好的数据隔离性等优势，是企业设备上云的首选。详情请参见[公共实例与您购买的实例](/cn.zh-CN/.mdsection_bks_kjn_7um)。

若您已在公共实例中管理设备，但希望享受您购买的实例的种种优势，可以将存量设备迁移到您购买的企业版实例中管理。通过设备分发，您可以便捷地将公共实例中的设备迁移到新的实例。

设备分发详细信息，请参见[设备分发](/cn.zh-CN/设备管理/设备划归/设备分发.md)。

## 操作步骤

将公共实例中的设备分发到您购买的实例，操作步骤如下：

**说明：**

-   请确保待分发的设备已具有设备分发能力，否则在控制台操作分发后，设备将无法正常连接物联网平台。若还不具有，可通过OTA升级将设备升级至有设备分发能力的版本，操作步骤请参见[设备分发流程第2~3步](/cn.zh-CN/设备管理/设备划归/设备分发.md)。
-   设备迁移过程将在1秒至数秒内完成，对业务几乎不会造成影响，但因迁移时会出现先断线再重连新实例的情况，建议在非业务高峰期进行操作。

1.  登录[物联网平台控制台](http://iot.console.aliyun.com/)。

2.  在存量设备所在地域购买实例，[购买页面](https://common-buy.aliyun.com/?commodityCode=iot_instc_public_cn)。实例购买与管理，参见[实例管理](/cn.zh-CN/.md)。

3.  从顶部导航栏的左侧第二个下拉菜单选择华东2（上海），切换到华东2（上海）地域。

    **说明：** 这里选择地域仅为了进入设备分发功能，与实例所属的地域无关。

4.  进入公共实例后，在左侧导航栏，选择**设备划归** \> **设备分发**。

5.  在设备分发页，单击**设备分发**。

6.  如图所示，填写分发配置，将目标实例设置为您购买的实例，选择设备时可通过手动勾选，也可以上传设备列表文件。

    ![设备分发](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/7257649951/p162292.png)

7.  单击**确认**。

    系统开始将产品数据及设备证书分发到新的实例。

8.  当列表状态一栏显示**分发任务完成**，您可以单击**下载分发结果**，下载文件查看各设备是否分发成功。

    ![分发任务完成](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/9257649951/p140808.png)


## 设备迁移表现

设备迁移到新实例过程中的MQTT连接发生如下变化：

1.  迁移前，设备连接公共实例。公共实例的接入域名为`${YourProductKey}.iot-as-mqtt.${YourRegionId}.aliyuncs.com`。
2.  控制台配置设备分发到新实例后，向设备下发分发通知，并与设备断开连接。
3.  设备连接到设备分发中心的全球统一域名`https://iot-auth-global.aliyuncs.com`，设备分发中心向设备发送新实例的接入域名`${YourInstanceId}.mqtt.iothub.aliyuncs.com`。
4.  设备连接到新实例的接入域名，设备上线。

    登录[物联网平台控制台](http://iot.console.aliyun.com/)，单击您的新实例，查看设备的在线状态和运行时数据，如下图所示。

    ![实例迁移后查看设备](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/0681613061/p174733.gif)


