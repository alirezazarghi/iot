---
keyword: [物联网, 物联网平台, IoT, 设备日志, 日志服务, 日志报表, 告警, 日志分析]
---

# 日志转储

物联网平台控制台的日志服务默认支持存储7天内的日志，同时支持将云端运行日志导出到您的阿里云日志服务的Logstore中进行长期存储。开通日志转储后，支持在物联网平台控制台查询分析日志，并提供日志报表、报表订阅、告警通知等功能。

已开通日志服务，参见[日志服务准备流程](/cn.zh-CN/数据采集/准备工作/准备工作.md)。

## 开通日志转储

**说明：** 日志转储功能暂时仅支持主账号使用。

需要为每一个需要开通日志转储功能的产品逐一进行开通操作。

1.  登录[物联网平台控制台](http://iot.console.aliyun.com/)。

2.  在实例概览页，找到对应的实例，单击实例进入实例详情页。

    ![实例概览](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8727475061/p174584.png)

3.  在左侧导航栏，选择**监控运维** \> **日志服务**。

4.  选择产品，单击**日志转储**页签。

5.  单击**立即开启**。

6.  阅读弹出对话框中的说明，单击**确定**。

    **说明：** 若还未开通日志服务，单击**立即开启**将跳转到日志服务开通入口。

    产品开通日志转储功能，系统自动创建日志存储位置、日志导出服务关联角色。

    -   日志存储位置：

        -   Project：iot-log-$\{uid\}-$\{regionId\}。其中，$\{uid\}是您的阿里云账号ID，$\{regionId\}是您的物联网平台服务所在地域代码。
        -   Logstore：iot-logs。
        您的所有产品共用该存储位置，不同产品通过日志内容关键字ProductKey区分。详细日志说明，请参见[云端运行日志](/cn.zh-CN/监控运维/日志服务/云端运行日志.md)。

    -   日志导出服务关联角色：用于获得日志导出权限，请参见[角色说明](/cn.zh-CN/权限管理/账号授权/RAM授权管理/日志导出服务关联角色.md)。
7.  设置日志保存时间。导出的日志达到日志保存时间后将被删除，默认的日志保存时间为7天，可以设置为保存1天~3000天或永久保存。

    单击**设置日志保存时间**，跳转到Logstore管理页面，单击**修改**，设置后单击**保存**。


## 使用日志查询分析功能

开通日志转储后，您可以在[物联网平台控制台](http://iot.console.aliyun.com/)，对应实例的**监控运维** \> **日志服务** \> **日志转储**页面，进行以下操作：

-   查询分析日志：在**原始日志**页签，通过SQL语句查询指定时间内的日志，并进行统计分析，生成统计图表。SQL语法请参见[查询语法](/cn.zh-CN/查询与分析/查询语法与功能/查询语法.md)、[分析语法](/cn.zh-CN/查询与分析/实时分析简介.md)，使用统计图表请参见[分析图表](/cn.zh-CN/可视化与告警/统计图表/图表说明.md)。
-   快速分析：在**原始日志**页签查询日志后，快速分析日志某一字段在日志查询结果中的分布情况，请参见[快速分析](/cn.zh-CN/查询与分析/查询语法与功能/快速分析.md)。
-   查看报表：在**日志报表**页签，查看指定时间内的日志报表。日志报表反映设备运行情况和异常问题。包含以下项目：

    |报表|说明|
    |--|--|
    |设备上下线次数|折线图展示指定时间内，设备的上线次数、下线次数。|
    |设备上线IP按区域分布|地图展示指定时间内，设备上线IP的区域分布。|
    |设备上行/下行消息数量|折线图展示指定时间内，设备上行消息量、下行消息量。|
    |上行/下行消息量TOP20设备列表|列表展示上行消息量或下行消息量最多的20个设备，及相应的消息量。|
    |数据解析脚本错误码分布|饼图展示指定时间内，脚本解析错误码的分布。您可以通过错误码查询日志，查看日志中的脚本解析错误详情，有针对性地优化脚本。 |
    |数据解析脚本错误TOP10设备列表|列表展示指定时间内，发生脚本解析错误最多的10个设备，及相应的错误数量。您可以通过设备DeviceName查询日志，查看日志中脚本解析的错误详情，有针对性地优化脚本。 |
    |物模型校验错误码分布|饼图展示指定时间内，物模型校验错误码的分布。您可以通过错误码查询日志，查看日志中的物模型校验错误详情，定位问题。 |
    |物模型校验错误TOP10设备列表|列表展示指定时间内，发生物模型校验错误最多的10个设备，及相应的错误数量。您可以通过设备DeviceName查询日志，查看日志中的物模型校验错误详情，定位问题。 |
    |服务端订阅流转消息量|折线图展示指定时间内，AMQP、MNS服务端订阅的流转消息量。|
    |最近20条设备异常消息记录|饼图展示指定时间内，最近20条设备异常消息记录。您可以通过设备DeviceName和错误码查询日志，查看日志中的设备异常消息详情，定位问题。 |
    |云产品流转消息量|折线图展示指定时间内，云产品流转消息量。|
    |最近20条规则引擎流转异常记录|列表展示指定时间内，最近20条规则引擎流转异常记录。您可以通过设备DeviceName和错误码查询日志，查看日志中的规则引擎流转异常详情，定位问题。 |
    |云端API调用错误分布|饼图展示指定时间内，云端API调用错误分布。您可以通过API名称查询日志，通过日志详情和错误码定位问题。 |

    报表时间范围和时间粒度说明：

    -   报表默认展示最近1小时（整点时间）的数据，折线图的粒度为1分钟。
    -   设置时间范围，可在页面右上角单击蓝色的时间设置下拉框，或在单个报表右上角单击![按钮](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8659549951/p134213.jpg)\>**选择时间范围**进行设置。
    -   设置折线图的时间粒度，需要在**原始日志**页签使用SQL语言进行设置。相关语法请参见[日期和时间函数](/cn.zh-CN/查询与分析/SQL分析语法与功能/日期和时间函数.md)。

        例如：使用`bizCode:device | SELECT date_format(date_trunc('hour',__time__), '%m-%d %H:%i') AS Time, count(1) AS count , operation GROUP BY Time, operation ORDER BY Time limit 1440`，将时间粒度设为1小时。

-   订阅报表：系统定期将报表渲染为图片，通过邮件、钉钉机器人发送给指定人员。订阅报表操作请参见[订阅仪表盘](/cn.zh-CN/可视化与告警/仪表盘/订阅仪表盘.md)。
-   设置告警：当触发告警条件时，系统将通过短信、语音、邮件、钉钉机器人等方式发送告警信息。设置告警操作请参见[设置告警](/cn.zh-CN/可视化与告警/告警/设置告警.md)。

## 停止日志转储

产品的日志转储功能可以按需求随时关闭，以便节约存储空间。停止某个产品的日志转储功能操作为：

1.  登录[物联网平台控制台](http://iot.console.aliyun.com/)。

2.  在实例概览页，找到对应的实例，单击实例进入实例详情页。

    ![实例概览](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8727475061/p174584.png)

3.  在左侧导航栏，选择**监控运维** \> **日志服务**。

4.  选择产品，单击**日志转储**页签。

5.  单击**停止转储**，单击**确认**后停止该产品的日志转储功能。

    新产生的日志不再导出到Logstore中。已导出的日志仍保留，达到设置的日志保存时间后被删除。


